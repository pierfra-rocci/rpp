

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>API Reference &mdash; RAPAS Photometry Pipeline (RPP) v0.9.8 Documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=1a282f62"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Advanced Features" href="advanced_features.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980b9" >

          
          
          <a href="index.html" class="icon icon-home">
            RAPAS Photometry Pipeline (RPP)
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_features.html">Advanced Features</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#core-application-modules">Core Application Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#frontend-application-pages-app-py">Frontend Application (pages/app.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pipeline-processing-src-pipeline-py">Pipeline Processing (src/pipeline.py)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#astrometric-functions">Astrometric Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-processing-functions">Image Processing Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#photometry-functions">Photometry Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calibration-functions">Calibration Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#utility-functions-src-tools-py">Utility Functions (src/tools.py)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#file-and-data-handling">File and Data Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#header-and-wcs-utilities">Header and WCS Utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#catalog-and-network-functions">Catalog and Network Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#logging-and-visualization">Logging and Visualization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#version-information-src-version-py">Version Information (src/__version__.py)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#src.__version__.version"><code class="docutils literal notranslate"><span class="pre">version</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#src.__version__.version_info"><code class="docutils literal notranslate"><span class="pre">version_info</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-constants">Configuration Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#figure-sizes-src-tools-py">Figure Sizes (src/tools.py)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#src.tools.FIGURE_SIZES"><code class="docutils literal notranslate"><span class="pre">FIGURE_SIZES</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#photometric-bands-src-tools-py">Photometric Bands (src/tools.py)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#src.tools.GAIA_BANDS"><code class="docutils literal notranslate"><span class="pre">GAIA_BANDS</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#backend-api-backend-py">Backend API (backend.py)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#user-management-endpoints">User Management Endpoints</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-management">Configuration Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="#error-handling">Error Handling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#usage-examples">Usage Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-pipeline-usage">Basic Pipeline Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-processing-workflow">Custom Processing Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980b9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RAPAS Photometry Pipeline (RPP)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">API Reference</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/api.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="api-reference">
<h1>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading"></a></h1>
<p>This page documents the key functions and modules used within the RAPAS Photometry Pipeline application. The pipeline is organized into several modules handling different aspects of astronomical image analysis.</p>
<section id="core-application-modules">
<h2>Core Application Modules<a class="headerlink" href="#core-application-modules" title="Link to this heading"></a></h2>
<section id="frontend-application-pages-app-py">
<h3>Frontend Application (pages/app.py)<a class="headerlink" href="#frontend-application-pages-app-py" title="Link to this heading"></a></h3>
</section>
<section id="pipeline-processing-src-pipeline-py">
<h3>Pipeline Processing (src/pipeline.py)<a class="headerlink" href="#pipeline-processing-src-pipeline-py" title="Link to this heading"></a></h3>
<section id="astrometric-functions">
<h4>Astrometric Functions<a class="headerlink" href="#astrometric-functions" title="Link to this heading"></a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="src.pipeline.solve_with_astrometrynet">
<span class="sig-prename descclassname"><span class="pre">src.pipeline.</span></span><span class="sig-name descname"><span class="pre">solve_with_astrometrynet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/pipeline.html#solve_with_astrometrynet"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.pipeline.solve_with_astrometrynet" title="Link to this definition"></a></dt>
<dd><p>Solve astrometric plate using local Astrometry.Net installation via stdpipe.
This function loads a FITS image, detects objects using photutils, and uses stdpipe’s
blind_match_objects wrapper around Astrometry.Net to determine accurate WCS information.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – Path to the FITS image file that needs astrometric solving</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(wcs_object, updated_header) where:
- wcs_object: astropy.wcs.WCS object containing the WCS solution
- updated_header: Original header updated with WCS keywords</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function requires:
- Local Astrometry.Net installation with solve-field binary
- Appropriate index files for the field scale
- The image should contain enough stars for plate solving (typically &gt;10)</p>
<p>Uses stdpipe.astrometry.blind_match_objects for cleaner interface.</p>
<p>Solve astrometric plate using local Astrometry.Net installation via stdpipe. Performs blind plate solving with automatic parameter optimization and WCS validation.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.pipeline.refine_astrometry_with_stdpipe">
<span class="sig-prename descclassname"><span class="pre">src.pipeline.</span></span><span class="sig-name descname"><span class="pre">refine_astrometry_with_stdpipe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">science_header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wcs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fwhm_estimate</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pixel_scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_band</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/pipeline.html#refine_astrometry_with_stdpipe"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.pipeline.refine_astrometry_with_stdpipe" title="Link to this definition"></a></dt>
<dd><p>Perform astrometry refinement using stdpipe SCAMP and GAIA DR3 catalog.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image_data</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The 2D image array</p></li>
<li><p><strong>science_header</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><em>dict</em></a>) – FITS header with WCS information</p></li>
<li><p><strong>wcs</strong> (<a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.wcs.WCS.html#astropy.wcs.WCS" title="(in Astropy v7.1)"><em>astropy.wcs.WCS</em></a>) – Initial WCS object</p></li>
<li><p><strong>fwhm_estimate</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – FWHM estimate in pixels</p></li>
<li><p><strong>pixel_scale</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Pixel scale in arcseconds per pixel</p></li>
<li><p><strong>filter_band</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – Gaia magnitude band to use for catalog matching</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Refined WCS object if successful, None otherwise</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.wcs.WCS.html#astropy.wcs.WCS" title="(in Astropy v7.1)">astropy.wcs.WCS</a> or None</p>
</dd>
</dl>
<p>Perform astrometry refinement using stdpipe SCAMP and GAIA DR3 catalog. Provides high-precision astrometric solutions with distortion correction.</p>
</dd></dl>

</section>
<section id="image-processing-functions">
<h4>Image Processing Functions<a class="headerlink" href="#image-processing-functions" title="Link to this heading"></a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="src.pipeline.detect_remove_cosmic_rays">
<span class="sig-prename descclassname"><span class="pre">src.pipeline.</span></span><span class="sig-name descname"><span class="pre">detect_remove_cosmic_rays</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gain</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readnoise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigclip</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigfrac</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">objlim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/pipeline.html#detect_remove_cosmic_rays"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.pipeline.detect_remove_cosmic_rays" title="Link to this definition"></a></dt>
<dd><p>Detect and remove cosmic rays from an astronomical image using
astroscrappy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image_data</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The 2D image array</p></li>
<li><p><strong>gain</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a><em>, </em><em>optional</em>) – CCD gain (electrons/ADU), default=1.0</p></li>
<li><p><strong>readnoise</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a><em>, </em><em>optional</em>) – CCD read noise (electrons), default=6.5</p></li>
<li><p><strong>sigclip</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a><em>, </em><em>optional</em>) – Detection sigma threshold, default=4.5</p></li>
<li><p><strong>sigfrac</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a><em>, </em><em>optional</em>) – Fractional detection threshold, default=0.3</p></li>
<li><p><strong>objlim</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a><em>, </em><em>optional</em>) – Minimum contrast between cosmic ray and underlying object, default=5.0</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a><em>, </em><em>optional</em>) – Whether to print verbose output, default=False</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(cleaned_image, mask, num_cosmic_rays) where:
- cleaned_image: numpy.ndarray with cosmic rays removed
- mask: boolean numpy.ndarray showing cosmic ray locations (True where cosmic rays were detected)
- num_cosmic_rays: int, number of cosmic rays detected</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses the L.A.Cosmic algorithm implemented in astroscrappy.
The algorithm detects cosmic rays using Laplacian edge detection.</p>
<p>Detect and remove cosmic rays from astronomical images using astroscrappy L.A.Cosmic algorithm. Configurable parameters for different detector types.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.pipeline.estimate_background">
<span class="sig-prename descclassname"><span class="pre">src.pipeline.</span></span><span class="sig-name descname"><span class="pre">estimate_background</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">box_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/pipeline.html#estimate_background"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.pipeline.estimate_background" title="Link to this definition"></a></dt>
<dd><p>Estimate the background and background RMS of an astronomical image.</p>
<p>Uses photutils.Background2D to create a 2D background model with sigma-clipping
and the SExtractor background estimation algorithm. Includes error handling
and automatic adjustment for small images.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image_data</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The 2D image array</p></li>
<li><p><strong>box_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>, </em><em>optional</em>) – The box size in pixels for the local background estimation.
Will be automatically adjusted if the image is small.</p></li>
<li><p><strong>filter_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>, </em><em>optional</em>) – Size of the filter for smoothing the background.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(background_2d_object, error_message) where:
- background_2d_object: photutils.Background2D object if successful, None if failed
- error_message: None if successful, string describing the error if failed</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function automatically adjusts the box_size and filter_size parameters
if the image is too small, and handles various edge cases to ensure robust
background estimation.</p>
<p>Estimate sky background and RMS using photutils.Background2D with SExtractor algorithm. Includes visualization and FITS output generation.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.pipeline.make_border_mask">
<span class="sig-prename descclassname"><span class="pre">src.pipeline.</span></span><span class="sig-name descname"><span class="pre">make_border_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">border=50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invert=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype=&lt;class</span> <span class="pre">'bool'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/pipeline.html#make_border_mask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.pipeline.make_border_mask" title="Link to this definition"></a></dt>
<dd><p>Create a binary mask for an image excluding one or more border regions.</p>
<p>This function creates a mask that can be used to exclude border pixels
from analysis, which is useful for operations that might be affected
by edge artifacts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The input image as a NumPy array</p></li>
<li><p><strong>border</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><em>tuple</em></a><em> of </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>, </em><em>default=50</em>) – Border size(s) to exclude from the mask:
- If int: same border size on all sides
- If tuple of 2 elements: (vertical, horizontal) borders
- If tuple of 4 elements: (top, bottom, left, right) borders</p></li>
<li><p><strong>invert</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a><em>, </em><em>default=True</em>) – If True, the mask will be inverted (False for border regions)
If False, the mask will be True for non-border regions</p></li>
<li><p><strong>dtype</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.dtype.html#numpy.dtype" title="(in NumPy v2.3)"><em>numpy.dtype</em></a><em>, </em><em>default=bool</em>) – Data type of the output mask</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Binary mask with the same height and width as the input image</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)">numpy.ndarray</a></p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.13)"><strong>TypeError</strong></a> – If image is not a NumPy array or border is not of the correct type</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> – If image is empty, borders are negative, borders are larger than the image,
    or border tuple has an invalid length</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create a mask with 10px border on all sides</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">make_border_mask</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create a mask with different vertical/horizontal borders</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">make_border_mask</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create a mask with custom borders for each side</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">make_border_mask</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Create binary mask for excluding border regions from analysis. Supports flexible border specifications and handles edge artifacts.</p>
</dd></dl>

</section>
<section id="photometry-functions">
<h4>Photometry Functions<a class="headerlink" href="#photometry-functions" title="Link to this heading"></a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="src.pipeline.detection_and_photometry">
<span class="sig-prename descclassname"><span class="pre">src.pipeline.</span></span><span class="sig-name descname"><span class="pre">detection_and_photometry</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">science_header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_fwhm_pixel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold_sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detection_mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_band</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/pipeline.html#detection_and_photometry"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.pipeline.detection_and_photometry" title="Link to this definition"></a></dt>
<dd><p>Perform a complete photometry workflow on an astronomical image.</p>
<dl class="simple">
<dt>This function executes the following steps:</dt><dd><ol class="arabic simple">
<li><p>Estimate the sky background and its RMS.</p></li>
<li><p>Detect sources using DAOStarFinder.</p></li>
<li><p>Optionally refine the WCS using GAIA DR3 and stdpipe.</p></li>
<li><p>Perform aperture photometry on detected sources.</p></li>
<li><p>Perform PSF photometry using an empirical PSF model.</p></li>
</ol>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image_data</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – 2D array of the image data.</p></li>
<li><p><strong>_science_header</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><em>dict</em></a><em> or </em><a class="reference external" href="https://docs.astropy.org/en/stable/io/fits/api/headers.html#astropy.io.fits.Header" title="(in Astropy v7.1)"><em>astropy.io.fits.Header</em></a>) – FITS header or dictionary with image metadata.</p></li>
<li><p><strong>mean_fwhm_pixel</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Estimated FWHM in pixels, used for aperture and PSF sizing.</p></li>
<li><p><strong>threshold_sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Detection threshold in sigma above background.</p></li>
<li><p><strong>detection_mask</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>) – Border size in pixels to mask during detection.</p></li>
<li><p><strong>filter_band</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – Photometric band for catalog matching and calibration.</p></li>
<li><p><strong>gb</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><em>optional</em>) – Gaia band name for catalog queries (default: “Gmag”).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>(phot_table, epsf_table, daofind, bkg), where:
phot_table : astropy.table.Table</p>
<blockquote>
<div><p>Results of aperture photometry.</p>
</div></blockquote>
<dl class="simple">
<dt>epsf_table<span class="classifier">astropy.table.Table or None</span></dt><dd><p>Results of PSF photometry, or None if PSF fitting failed.</p>
</dd>
<dt>daofind<span class="classifier">photutils.detection.DAOStarFinder</span></dt><dd><p>DAOStarFinder object used for source detection.</p>
</dd>
<dt>bkg<span class="classifier">photutils.background.Background2D</span></dt><dd><p>Background2D object containing the background model.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>WCS refinement uses stdpipe and GAIA DR3 if enabled in session state.</p></li>
<li><p>Adds RA/Dec coordinates to photometry tables if WCS is available.</p></li>
<li><p>Computes instrumental magnitudes for both aperture and PSF photometry.</p></li>
<li><p>Displays progress and results in the Streamlit interface.</p></li>
</ul>
<p>Complete photometry workflow including source detection, multi-aperture photometry, PSF photometry, and coordinate transformation. Main processing pipeline function.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.pipeline.perform_psf_photometry">
<span class="sig-prename descclassname"><span class="pre">src.pipeline.</span></span><span class="sig-name descname"><span class="pre">perform_psf_photometry</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">photo_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fwhm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">daostarfind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/pipeline.html#perform_psf_photometry"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.pipeline.perform_psf_photometry" title="Link to this definition"></a></dt>
<dd><p>Perform PSF (Point Spread Function) photometry using an empirically-constructed PSF model.</p>
<p>This function builds an empirical PSF (EPSF) from bright stars in the image
and then uses this model to perform PSF photometry on all detected sources.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – Image with sky background subtracted</p></li>
<li><p><strong>photo_table</strong> (<a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.table.Table.html#astropy.table.Table" title="(in Astropy v7.1)"><em>astropy.table.Table</em></a>) – Table containing source positions</p></li>
<li><p><strong>fwhm</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Full Width at Half Maximum in pixels, used to define extraction and fitting sizes</p></li>
<li><p><strong>daostarfind</strong> (<em>callable</em>) – Star detection function used as “finder” in PSF photometry</p></li>
<li><p><strong>mask</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a><em>, </em><em>optional</em>) – Mask to exclude certain image areas from analysis</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>phot_epsf_result : Table containing PSF photometry results, including fitted fluxes and positions</p></li>
<li><p>epsf : The fitted EPSF model used for photometry</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Tuple[<a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.table.Table.html#astropy.table.Table" title="(in Astropy v7.1)">astropy.table.Table</a>, <a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.psf.EPSFModel.html#photutils.psf.EPSFModel" title="(in photutils v2.2)">photutils.psf.EPSFModel</a>]</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function displays the extracted stars used for PSF model building and the
resulting PSF model in the Streamlit interface. It also saves the PSF model
as a FITS file in the output directory.</p>
<p>If successful, the photometry results are also stored in the Streamlit session state
under ‘epsf_photometry_result’.</p>
<p>Perform PSF photometry using empirically-constructed PSF model. Includes star selection, PSF building, and iterative fitting.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.pipeline.fwhm_fit">
<span class="sig-prename descclassname"><span class="pre">src.pipeline.</span></span><span class="sig-name descname"><span class="pre">fwhm_fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fwhm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">std_lo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">std_hi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/pipeline.html#fwhm_fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.pipeline.fwhm_fit" title="Link to this definition"></a></dt>
<dd><p>Estimate the Full Width at Half Maximum (FWHM) of stars in an astronomical image.</p>
<p>This function detects sources in the image using DAOStarFinder, filters them based on
flux values, and fits 1D Gaussian models to the marginal distributions of each source
to calculate FWHM values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The 2D image array containing astronomical sources</p></li>
<li><p><strong>fwhm</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Initial FWHM estimate in pixels, used for source detection</p></li>
<li><p><strong>pixel_scale</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – The pixel scale of the image in arcseconds per pixel</p></li>
<li><p><strong>mask</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a><em>, </em><em>optional</em>) – Boolean mask array where True indicates pixels to ignore during source detection</p></li>
<li><p><strong>std_lo</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a><em>, </em><em>default=0.5</em>) – Lower bound for flux filtering, in standard deviations below median flux</p></li>
<li><p><strong>std_hi</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a><em>, </em><em>default=0.5</em>) – Upper bound for flux filtering, in standard deviations above median flux</p></li>
<li><p><strong>_img</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>ndarray</em></a>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The median FWHM value in pixels (rounded to nearest integer) if successful,
or None if no valid sources could be measured</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)">float</a> or None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function uses marginal sums along the x and y dimensions and fits 1D Gaussian
profiles to estimate FWHM. For each source, a box of size ~6×FWHM is extracted,
and profiles are fit independently in both dimensions, with the results averaged.</p>
<p>Progress updates and error messages are displayed using Streamlit.</p>
<p>Estimate FWHM of stars using Gaussian fitting on marginal sums. Provides robust seeing estimates with quality filtering.</p>
</dd></dl>

</section>
<section id="calibration-functions">
<h4>Calibration Functions<a class="headerlink" href="#calibration-functions" title="Link to this heading"></a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="src.pipeline.cross_match_with_gaia">
<span class="sig-prename descclassname"><span class="pre">src.pipeline.</span></span><span class="sig-name descname"><span class="pre">cross_match_with_gaia</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_phot_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">science_header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pixel_size_arcsec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_fwhm_pixel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_band</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_max_mag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refined_wcs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/pipeline.html#cross_match_with_gaia"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.pipeline.cross_match_with_gaia" title="Link to this definition"></a></dt>
<dd><p>Cross-match detected sources with the GAIA DR3 star catalog.
This function queries the GAIA catalog for a region matching the image field of view,
applies filtering based on magnitude range, and matches GAIA sources to the detected sources.
It also applies quality filters including variability, color index, and astrometric quality
to ensure reliable photometric calibration stars.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>_phot_table</strong> (<a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.table.Table.html#astropy.table.Table" title="(in Astropy v7.1)"><em>astropy.table.Table</em></a>) – Table containing detected source positions (underscore prevents caching issues)</p></li>
<li><p><strong>_science_header</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><em>dict</em></a><em> or </em><a class="reference external" href="https://docs.astropy.org/en/stable/io/fits/api/headers.html#astropy.io.fits.Header" title="(in Astropy v7.1)"><em>astropy.io.fits.Header</em></a>) – FITS header with WCS information (underscore prevents caching issues)</p></li>
<li><p><strong>pixel_size_arcsec</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Pixel scale in arcseconds per pixel</p></li>
<li><p><strong>mean_fwhm_pixel</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – FWHM in pixels, used to determine matching radius</p></li>
<li><p><strong>filter_band</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – GAIA magnitude band to use for filtering (e.g., ‘phot_g_mean_mag’, ‘phot_bp_mean_mag’,
‘phot_rp_mean_mag’ or other synthetic photometry bands)</p></li>
<li><p><strong>filter_max_mag</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Maximum magnitude for GAIA source filtering</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DataFrame containing matched sources with both measured and GAIA catalog data,
or None if the cross-match failed or found no matches</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.3.0)">pandas.DataFrame</a> or None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The maximum separation for matching is set to twice the FWHM in arcseconds</p></li>
<li><p>Applies multiple quality filters to ensure reliable calibration:
- Excludes variable stars (phot_variable_flag != “VARIABLE”)
- Limits color index range (abs(bp_rp) &lt; 1.5)
- Ensures good astrometric solutions (ruwe &lt;= 1.5)</p></li>
<li><p>For non-standard Gaia bands, queries synthetic photometry from gaiadr3.synthetic_photometry_gspc</p></li>
<li><p>Progress and status updates are displayed in the Streamlit interface</p></li>
<li><p>The underscore prefix in parameter names prevents issues with caching when the function is called repeatedly</p></li>
</ul>
<p>Cross-match detected sources with GAIA DR3 catalog. Includes quality filtering and support for synthetic photometry bands.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.pipeline.calculate_zero_point">
<span class="sig-prename descclassname"><span class="pre">src.pipeline.</span></span><span class="sig-name descname"><span class="pre">calculate_zero_point</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_phot_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_matched_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_band</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">air</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/pipeline.html#calculate_zero_point"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.pipeline.calculate_zero_point" title="Link to this definition"></a></dt>
<dd><p>Calculate photometric zero point from matched sources with GAIA.</p>
<p>The zero point transforms instrumental magnitudes to the standard GAIA magnitude system,
accounting for atmospheric extinction using the provided airmass.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>_phot_table</strong> (<a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.table.Table.html#astropy.table.Table" title="(in Astropy v7.1)"><em>astropy.table.Table</em></a><em> or </em><a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.3.0)"><em>pandas.DataFrame</em></a>) – Photometry results table (underscore prevents caching issues)</p></li>
<li><p><strong>_matched_table</strong> (<a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.3.0)"><em>pandas.DataFrame</em></a>) – Table of GAIA cross-matched sources (used for calibration)</p></li>
<li><p><strong>filter_band</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – GAIA magnitude band used (e.g., ‘phot_g_mean_mag’)</p></li>
<li><p><strong>air</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Airmass value for atmospheric extinction correction</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(zero_point_value, zero_point_std, matplotlib_figure) where:
- zero_point_value: Float value of the calculated zero point
- zero_point_std: Standard deviation of the zero point
- matplotlib_figure: Figure object showing GAIA vs. calibrated magnitudes</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Uses sigma clipping to remove outliers from zero point calculation</p></li>
<li><p>Applies a simple atmospheric extinction correction of 0.1*airmass</p></li>
<li><p>Stores the calibrated photometry table in session state as ‘final_phot_table’</p></li>
<li><p>Creates and saves a plot showing the relation between GAIA and calibrated magnitudes</p></li>
</ul>
<p>Calculate photometric zero point from GAIA-matched sources. Robust calibration with outlier rejection and atmospheric extinction correction.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.pipeline.airmass">
<span class="sig-prename descclassname"><span class="pre">src.pipeline.</span></span><span class="sig-name descname"><span class="pre">airmass</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">observatory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_details</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/pipeline.html#airmass"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.pipeline.airmass" title="Link to this definition"></a></dt>
<dd><p>Calculate the airmass for a celestial object from observation parameters.</p>
<p>Airmass is a measure of the optical path length through Earth’s atmosphere.
This function calculates it from header information and observatory location,
handling multiple coordinate formats and performing physical validity checks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>_header</strong> (<em>Dict</em>) – FITS header or dictionary containing observation information.
Must include:
- Coordinates (RA/DEC or OBJRA/OBJDEC)
- Observation date (DATE-OBS)</p></li>
<li><p><strong>observatory</strong> (<em>Dict</em><em>, </em><em>optional</em>) – <p>Information about the observatory. If not provided, uses the default.
Format: {</p>
<blockquote>
<div><p>’name’: str,           # Observatory name
‘latitude’: float,     # Latitude in degrees
‘longitude’: float,    # Longitude in degrees
‘elevation’: float     # Elevation in meters</p>
</div></blockquote>
<p>}</p>
</p></li>
<li><p><strong>return_details</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a><em>, </em><em>optional</em>) – If True, returns additional information about the observation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>If return_details=False: airmass (float)</p></li>
<li><p>If return_details=True: (airmass, observation_details)
where observation_details is a dictionary with:
- observatory name
- datetime
- target coordinates
- altitude/azimuth
- sun altitude
- observation type (night/twilight/day)</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)">float</a>, Tuple[<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)">float</a>, Dict]]</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Airmass is approximately sec(z) where z is the zenith angle.
The function enforces physical constraints (airmass ≥ 1.0) and
displays warnings for extreme values. It also determines whether
the observation was taken during night, twilight or day.</p>
<p>Calculate airmass for celestial objects from observation parameters. Handles multiple coordinate formats and observatory locations.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.pipeline.enhance_catalog">
<span class="sig-prename descclassname"><span class="pre">src.pipeline.</span></span><span class="sig-name descname"><span class="pre">enhance_catalog</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">api_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">final_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matched_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pixel_scale_arcsec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_radius_arcsec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">60</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/pipeline.html#enhance_catalog"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.pipeline.enhance_catalog" title="Link to this definition"></a></dt>
<dd><p>Enhance a photometric catalog with cross-matches from multiple
astronomical databases.</p>
<p>This function queries several catalogs and databases including:
- GAIA DR3 (using previously matched sources)
- Astro-Colibri (for known astronomical sources)
- SIMBAD (for object identifications and classifications)
- SkyBoT (for solar system objects)
- AAVSO VSX (for variable stars)
- VizieR VII/294 (for quasars)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>final_table</strong> (<a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.3.0)"><em>pandas.DataFrame</em></a>) – Final photometry catalog with RA/Dec coordinates</p></li>
<li><p><strong>matched_table</strong> (<a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.3.0)"><em>pandas.DataFrame</em></a>) – Table of already matched GAIA sources (used for calibration)</p></li>
<li><p><strong>header</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><em>dict</em></a><em> or </em><a class="reference external" href="https://docs.astropy.org/en/stable/io/fits/api/headers.html#astropy.io.fits.Header" title="(in Astropy v7.1)"><em>astropy.io.fits.Header</em></a>) – FITS header with observation information</p></li>
<li><p><strong>pixel_scale_arcsec</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a>) – Pixel scale in arcseconds per pixel</p></li>
<li><p><strong>search_radius_arcsec</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a><em>, </em><em>optional</em>) – Search radius for cross-matching in arcseconds, default=60</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Input dataframe with added catalog information including:
- GAIA data for calibration stars
- Astro-Colibri source identifications
- SIMBAD identifications and object types
- Solar system object identifications from SkyBoT
- Variable star information from AAVSO VSX
- Quasar information from VizieR VII/294
- A summary column ‘catalog_matches’ listing all catalog matches</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.3.0)">pandas.DataFrame</a></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function shows progress updates in the Streamlit interface and creates</p>
<p>a summary display of matched objects. Queries are made with appropriate
error handling to prevent failures if any catalog service is unavailable.
API requests are processed in batches to avoid overwhelming servers.</p>
<p>Enhance photometric catalog with cross-matches from multiple astronomical databases including SIMBAD, Astro-Colibri, SkyBoT, AAVSO VSX, and Milliquas.</p>
</dd></dl>

</section>
</section>
<section id="utility-functions-src-tools-py">
<h3>Utility Functions (src/tools.py)<a class="headerlink" href="#utility-functions-src-tools-py" title="Link to this heading"></a></h3>
<section id="file-and-data-handling">
<h4>File and Data Handling<a class="headerlink" href="#file-and-data-handling" title="Link to this heading"></a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="src.tools.get_base_filename">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">get_base_filename</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_obj</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#get_base_filename"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.get_base_filename" title="Link to this definition"></a></dt>
<dd><p>Extract the base filename (without extension) from a file object.</p>
<p>Handles common cases like single extensions (.fits) and double extensions
(.fits.fz, .tar.gz).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_obj</strong> (<em>file-like object</em><em> or </em><em>None</em>) – An object representing the uploaded file, typically expected to have a
<cite>.name</cite> attribute (like Streamlit’s <cite>UploadedFile</cite>). If None, returns
a default filename “photometry”.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The base filename derived from <cite>file_obj.name</cite> by removing the
extension(s). Returns “photometry” if <cite>file_obj</cite> is None.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">MockFile</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;image.fits.fz&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_base_filename</span><span class="p">(</span><span class="n">MockFile</span><span class="p">())</span>
<span class="go">&#39;image&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">MockFile</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;catalog.csv&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_base_filename</span><span class="p">(</span><span class="n">MockFile</span><span class="p">())</span>
<span class="go">&#39;catalog&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_base_filename</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="go">&#39;photometry&#39;</span>
</pre></div>
</div>
<p>Extract base filename without extension from file objects. Handles double extensions and special cases.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.tools.ensure_output_directory">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">ensure_output_directory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'rpp_results'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#ensure_output_directory"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.ensure_output_directory" title="Link to this definition"></a></dt>
<dd><p>Ensure the specified output directory exists, creating it if necessary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>directory</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><em>optional</em>) – The path to the directory to ensure exists. Defaults to “rpp_results”.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The absolute path to the created or existing directory. If directory
creation fails due to an exception (e.g., permission error), it
returns the path to the current working directory (“.”) and may
display a warning using Streamlit if available in the context.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Uses os.makedirs to create parent directories as needed.</p></li>
<li><p>Catches potential exceptions during directory creation.</p></li>
</ul>
<p>Create output directory if it doesn’t exist. Handles permission errors and provides fallback options.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.tools.cleanup_temp_files">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">cleanup_temp_files</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#cleanup_temp_files"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.cleanup_temp_files" title="Link to this definition"></a></dt>
<dd><p>Remove temporary FITS files potentially created during processing.</p>
<p>Specifically targets files stored in the directory indicated by
<cite>st.session_state[‘science_file_path’]</cite>. It attempts to remove all files
ending with ‘.fits’, ‘.fit’, or ‘.fts’ (case-insensitive) within that
directory.</p>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Relies on <cite>st.session_state[‘science_file_path’]</cite> being set and pointing
to a valid temporary file path whose directory contains the files to be
cleaned.</p></li>
<li><p>Uses <cite>st.warning</cite> to report errors if removal fails for individual files
or if the base directory cannot be accessed.</p></li>
<li><p>This function has side effects (deleting files) and depends on
Streamlit’s session state. It does not return any value.</p></li>
</ul>
<p>Remove temporary FITS files created during processing. Automatic cleanup with error handling.</p>
</dd></dl>

</section>
<section id="header-and-wcs-utilities">
<h4>Header and WCS Utilities<a class="headerlink" href="#header-and-wcs-utilities" title="Link to this heading"></a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="src.tools.safe_wcs_create">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">safe_wcs_create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">header</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#safe_wcs_create"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.safe_wcs_create" title="Link to this definition"></a></dt>
<dd><p>Safely create an Astropy WCS object from a FITS header.</p>
<p>Validates the presence of required WCS keywords, handles potential errors
during WCS object creation, and attempts to simplify higher-dimensional WCS
objects to celestial coordinates. Also attempts to remove potentially
problematic non-standard keywords before WCS creation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>header</strong> (<a class="reference external" href="https://docs.astropy.org/en/stable/io/fits/api/headers.html#astropy.io.fits.Header" title="(in Astropy v7.1)"><em>astropy.io.fits.Header</em></a><em> or </em><em>dict-like</em>) – The FITS header containing WCS information.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>(wcs_object, None): If successful, returns the created WCS object
and None for the error message.</p></li>
<li><p>(None, error_message): If failed, returns None for the WCS object
and a string describing the error (e.g., missing keywords,
creation error, invalid object).</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a> (<a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.wcs.WCS.html#astropy.wcs.WCS" title="(in Astropy v7.1)">astropy.wcs.WCS</a> | None, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a> | None)</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Required WCS keywords checked: CTYPE1, CTYPE2, CRVAL1, CRVAL2,
CRPIX1, CRPIX2.</p></li>
<li><p>Attempts to remove ‘XPIXELSZ’, ‘YPIXELSZ’, ‘CDELTM1’, ‘CDELTM2’ if
present.</p></li>
<li><p>If the initial WCS object has more than 2 pixel dimensions, it attempts
to extract the celestial WCS using <cite>wcs_obj.celestial</cite>.</p></li>
<li><p>Validates that the final WCS object has transformation attributes
(<cite>.wcs</cite>).</p></li>
</ul>
<p>Safely create WCS object from FITS header with validation and error handling. Removes problematic keywords and validates transformations.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.tools.fix_header">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">fix_header</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">header</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#fix_header"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.fix_header" title="Link to this definition"></a></dt>
<dd><p>Fix common issues in FITS headers based on stdweb processing approach.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>header</strong> (<a class="reference external" href="https://docs.astropy.org/en/stable/io/fits/api/headers.html#astropy.io.fits.Header" title="(in Astropy v7.1)"><em>astropy.io.fits.Header</em></a>) – FITS header object to fix</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fixed header object</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.astropy.org/en/stable/io/fits/api/headers.html#astropy.io.fits.Header" title="(in Astropy v7.1)">astropy.io.fits.Header</a></p>
</dd>
</dl>
<p>Fix common issues in FITS headers for better WCS compatibility. Removes problematic keywords and standardizes coordinate systems.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.tools.get_header_value">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">get_header_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#get_header_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.get_header_value" title="Link to this definition"></a></dt>
<dd><p>Extract a value from a FITS header by trying multiple possible keywords.</p>
<p>Iterates through a list of potential keywords and returns the value of the
first one found in the header. Useful for handling variations in FITS
keyword conventions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>header</strong> (<a class="reference external" href="https://docs.astropy.org/en/stable/io/fits/api/headers.html#astropy.io.fits.Header" title="(in Astropy v7.1)"><em>astropy.io.fits.Header</em></a><em> or </em><em>dict-like</em><em> or </em><em>None</em>) – The FITS header object or dictionary to search within. If None, the
default value is returned immediately.</p></li>
<li><p><strong>keys</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>]</em>) – A list of header keyword strings to try, in order of preference.</p></li>
<li><p><strong>default</strong> (<em>any</em><em>, </em><em>optional</em>) – The value to return if none of the specified keys are found in the
header. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The value associated with the first key found in the header, or the
<cite>default</cite> value if none of the keys are present or the header is None.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>any</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">([(</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">,</span> <span class="mf">120.0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;INSTRUME&#39;</span><span class="p">,</span> <span class="s1">&#39;CCD&#39;</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exposure</span> <span class="o">=</span> <span class="n">get_header_value</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">,</span> <span class="s1">&#39;EXPOSURE&#39;</span><span class="p">,</span> <span class="s1">&#39;EXP&#39;</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">exposure</span><span class="p">)</span>
<span class="go">120.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filter_name</span> <span class="o">=</span> <span class="n">get_header_value</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;FILTER&#39;</span><span class="p">],</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">filter_name</span><span class="p">)</span>
<span class="go">Unknown</span>
</pre></div>
</div>
<p>Extract values from FITS headers using multiple possible keywords. Provides fallback options for varying keyword conventions.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.tools.extract_coordinates">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">extract_coordinates</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">header</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#extract_coordinates"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.extract_coordinates" title="Link to this definition"></a></dt>
<dd><p>Extract celestial coordinates (RA, Dec) from a FITS header.</p>
<p>Attempts to find Right Ascension (RA) and Declination (Dec) values by
checking a predefined list of common FITS keywords. Validates that the
extracted values are numeric and fall within reasonable astronomical
ranges.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>header</strong> (<a class="reference external" href="https://docs.astropy.org/en/stable/io/fits/api/headers.html#astropy.io.fits.Header" title="(in Astropy v7.1)"><em>astropy.io.fits.Header</em></a><em> or </em><em>dict-like</em><em> or </em><em>None</em>) – The FITS header object or dictionary to search for coordinate keywords.
If None, returns (None, None, “No header available”).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>(ra, dec, source_description): If coordinates are found and valid,
returns RA (degrees), Dec (degrees), and a string indicating the
keywords used (e.g., “RA/DEC”, “OBJRA/OBJDEC”).</p></li>
<li><p>(None, None, error_message): If coordinates are not found, are
non-numeric, or fall outside valid ranges (RA: -360 to 360,
Dec: -90 to 90), returns None for RA and Dec, and a string
describing the issue (e.g., “Coordinates not found in header”,
“Invalid RA value: …”, “Non-numeric coordinates: …”).</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)">float</a> | None, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)">float</a> | None, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a>)</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>RA keywords checked (in order): ‘RA’, ‘OBJRA’, ‘RA—’, ‘CRVAL1’.</p></li>
<li><p>Dec keywords checked (in order): ‘DEC’, ‘OBJDEC’, ‘DEC—’, ‘CRVAL2’.</p></li>
<li><p>Validation ranges: RA [-360, 360], Dec [-90, 90].</p></li>
</ul>
<p>Extract celestial coordinates (RA, Dec) from FITS headers. Validates coordinate ranges and handles multiple formats.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.tools.extract_pixel_scale">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">extract_pixel_scale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">header</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#extract_pixel_scale"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.extract_pixel_scale" title="Link to this definition"></a></dt>
<dd><p>Extract or calculate the pixel scale (in arcseconds per pixel) from a
FITS header.</p>
<p>Tries multiple methods in order of preference:
1. Looks for direct pixel scale keywords (‘PIXSIZE’, ‘PIXSCALE’,</p>
<blockquote>
<div><p>‘PIXELSCAL’).</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Uses CD matrix elements (CD1_1, CD2_2) converted from deg to arcsec.</p></li>
<li><p>Calculates from pixel size (‘XPIXSZ’) and focal length (‘FOCALLEN’),
using the simple formula: 206 × pixel_size_microns / focal_length_mm.</p></li>
<li><p>If none of the above succeed, returns a default value.</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>header</strong> (<a class="reference external" href="https://docs.astropy.org/en/stable/io/fits/api/headers.html#astropy.io.fits.Header" title="(in Astropy v7.1)"><em>astropy.io.fits.Header</em></a><em> or </em><em>dict-like</em><em> or </em><em>None</em>) – The FITS header object or dictionary containing metadata. If None,
returns (1.0, “default (no header)”).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>(pixel_scale_value, source_description): Returns the determined pixel
scale in arcseconds per pixel and a string describing how it was
obtained.</p></li>
<li><p>The default pixel scale value returned if no information is found is
1.0 arcsec/pixel.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)">float</a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a>)</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Uses the simple formula: pixel_scale = 206 × pixel_size_microns / focal_length_mm</p></li>
<li><p>Assumes XPIXSZ is in micrometers unless XPIXSZU specifies otherwise.</p></li>
</ul>
<p>Extract or calculate pixel scale from FITS headers. Supports multiple methods including CD matrix, focal length calculation, and direct keywords.</p>
</dd></dl>

</section>
<section id="catalog-and-network-functions">
<h4>Catalog and Network Functions<a class="headerlink" href="#catalog-and-network-functions" title="Link to this heading"></a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="src.tools.get_json">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">get_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#get_json"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.get_json" title="Link to this definition"></a></dt>
<dd><p>Fetch JSON data from a given URL and handle errors gracefully.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>url</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – The URL to fetch JSON data from. Must start with ‘http’ or ‘https’.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>Parsed JSON data as a Python dictionary if the request is successful
and the response contains valid JSON.</p></li>
<li><p>A JSON-formatted string describing the error if the URL is invalid,
the request fails (network error, timeout, non-2xx status),
the response is empty, or the response is not valid JSON.
Example error format: ‘{“error”: “type”, “message”: “details”}’</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)">dict</a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Handles network errors (requests.exceptions.RequestException) and JSON
parsing errors (json.decoder.JSONDecodeError).</p></li>
<li><p>Validates the URL format.</p></li>
<li><p>Raises HTTPError for bad responses (4xx or 5xx).</p></li>
</ul>
<p>Fetch JSON data from URLs with robust error handling. Used for catalog queries and API interactions.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.tools.safe_catalog_query">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">safe_catalog_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_msg</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#safe_catalog_query"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.safe_catalog_query" title="Link to this definition"></a></dt>
<dd><p>Execute an astronomical catalog query function with robust error handling.</p>
<p>Wraps a callable (e.g., a function from astroquery) to catch common
exceptions like network errors, timeouts, and value errors that can occur
during queries to online astronomical databases.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query_func</strong> (<em>callable</em>) – The function to call for performing the catalog query.</p></li>
<li><p><strong>error_msg</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – A base error message string to prepend to any specific exception
message caught during the query execution.</p></li>
<li><p><strong>*args</strong> – Positional arguments to pass directly to <cite>query_func</cite>.</p></li>
<li><p><strong>**kwargs</strong> – Keyword arguments to pass directly to <cite>query_func</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>(result, None): If <cite>query_func</cite> executes successfully, returns its
result and None for the error message. The type of <cite>result</cite> depends
on <cite>query_func</cite>.</p></li>
<li><p>(None, error_message): If an exception occurs during execution,
returns None for the result and a formatted string describing the
error (e.g., “Failed to query SIMBAD: Network error - details”).</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a> (any | None, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a> | None)</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.simbad</span><span class="w"> </span><span class="kn">import</span> <span class="n">Simbad</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Assuming Simbad.query_object raises a Timeout error</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">safe_catalog_query</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Simbad</span><span class="o">.</span><span class="n">query_object</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;Failed to query SIMBAD&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;M31&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">error</span><span class="p">:</span>
<span class="gp">... </span>    <span class="c1"># Output: Query failed: Failed to query SIMBAD: Query timed out</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Query failed: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Execute catalog query functions with comprehensive error handling. Wrapper for astroquery and other catalog access functions.</p>
</dd></dl>

</section>
<section id="logging-and-visualization">
<h4>Logging and Visualization<a class="headerlink" href="#logging-and-visualization" title="Link to this heading"></a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="src.tools.initialize_log">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">initialize_log</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#initialize_log"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.initialize_log" title="Link to this definition"></a></dt>
<dd><p>Initialize and return an in-memory text buffer (StringIO) for logging.</p>
<p>Creates a StringIO object and writes a standard header including a
timestamp and the provided base filename, suitable for logging processing
steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>base_filename</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – The base name of the input file being processed, used in the log
header.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An initialized StringIO buffer containing the log header.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/io.html#io.StringIO" title="(in Python v3.13)">io.StringIO</a></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The log header format includes the title “RAPAS Photometry Pipeline Log”,
a separator line, the start timestamp, and the input filename.</p></li>
</ul>
<p>Initialize in-memory logging buffer with standard header format. Creates structured logs for processing workflows.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.tools.write_to_log">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">write_to_log</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log_buffer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'INFO'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#write_to_log"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.write_to_log" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Write a formatted message to the provided log buffer.</p>
<p>Prepends the message with a timestamp ([HH:MM:SS]) and the specified
log level (e.g., INFO, WARNING, ERROR).</p>
<dl class="simple">
<dt>log_buffer<span class="classifier">io.StringIO or None</span></dt><dd><p>The StringIO buffer object to write the log message to. If None,
the function does nothing.</p>
</dd>
<dt>message<span class="classifier">str</span></dt><dd><p>The log message content.</p>
</dd>
<dt>level<span class="classifier">str, optional</span></dt><dd><p>The severity level of the log message (e.g., “INFO”, “WARNING”,
“ERROR”). Defaults to “INFO”.</p>
</dd>
</dl>
<dl class="simple">
<dt>None</dt><dd><p>This function modifies the <cite>log_buffer</cite> in place and returns None.</p>
</dd>
</dl>
<ul class="simple">
<li><p>Format: “[HH:MM:SS] LEVEL: Message</p></li>
</ul>
</div></blockquote>
<p>“</p>
<p>Write formatted messages to log buffer with timestamps and severity levels. Structured logging for debugging and analysis.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="src.tools.create_figure">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">create_figure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'medium'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dpi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/tools.html#create_figure"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#src.tools.create_figure" title="Link to this definition"></a></dt>
<dd><p>Create a matplotlib Figure object with a predefined or default size and DPI.</p>
<p>Uses a dictionary <cite>FIGURE_SIZES</cite> to map descriptive size names (‘small’,
‘medium’, ‘large’, ‘wide’, ‘stars_grid’) to (width, height) tuples in
inches.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>size</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><em>optional</em>) – A key corresponding to a predefined figure size in the <cite>FIGURE_SIZES</cite>
global dictionary. Allowed values are ‘small’, ‘medium’, ‘large’,
‘wide’, ‘stars_grid’. If an invalid key is provided, it defaults to
‘medium’. Defaults to “medium”.</p></li>
<li><p><strong>dpi</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>, </em><em>optional</em>) – The resolution of the figure in dots per inch. Defaults to 120.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A matplotlib Figure object initialized with the specified or default
figsize and dpi.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="(in Matplotlib v3.10.3)">matplotlib.figure.Figure</a></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Relies on the global <cite>FIGURE_SIZES</cite> dictionary for size definitions.</p></li>
</ul>
<p>Create matplotlib figures with predefined sizes and DPI settings. Standardized figure creation for consistent output.</p>
</dd></dl>

</section>
</section>
<section id="version-information-src-version-py">
<h3>Version Information (src/__version__.py)<a class="headerlink" href="#version-information-src-version-py" title="Link to this heading"></a></h3>
<dl class="py data">
<dt class="sig sig-object py" id="src.__version__.version">
<span class="sig-prename descclassname"><span class="pre">src.__version__.</span></span><span class="sig-name descname"><span class="pre">version</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'0.9.8'</span></em><a class="headerlink" href="#src.__version__.version" title="Link to this definition"></a></dt>
<dd><p>str(object=’’) -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str</p>
<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.__str__() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to ‘strict’.</p>
<p>Current version string of the RAPAS Photometry Pipeline.</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="src.__version__.version_info">
<span class="sig-prename descclassname"><span class="pre">src.__version__.</span></span><span class="sig-name descname"><span class="pre">version_info</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">(0,</span> <span class="pre">9,</span> <span class="pre">8)</span></em><a class="headerlink" href="#src.__version__.version_info" title="Link to this definition"></a></dt>
<dd><p>Built-in immutable sequence.</p>
<p>If no argument is given, the constructor returns an empty tuple.
If iterable is specified the tuple is initialized from iterable’s items.</p>
<p>If the argument is a tuple, the return value is the same object.</p>
<p>Version tuple for programmatic version comparison.</p>
</dd></dl>

</section>
</section>
<section id="configuration-constants">
<h2>Configuration Constants<a class="headerlink" href="#configuration-constants" title="Link to this heading"></a></h2>
<section id="figure-sizes-src-tools-py">
<h3>Figure Sizes (src/tools.py)<a class="headerlink" href="#figure-sizes-src-tools-py" title="Link to this heading"></a></h3>
<dl class="py data">
<dt class="sig sig-object py" id="src.tools.FIGURE_SIZES">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">FIGURE_SIZES</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'large':</span> <span class="pre">(10,</span> <span class="pre">8),</span> <span class="pre">'medium':</span> <span class="pre">(8,</span> <span class="pre">6),</span> <span class="pre">'small':</span> <span class="pre">(6,</span> <span class="pre">5),</span> <span class="pre">'stars_grid':</span> <span class="pre">(10,</span> <span class="pre">8),</span> <span class="pre">'wide':</span> <span class="pre">(12,</span> <span class="pre">6)}</span></em><a class="headerlink" href="#src.tools.FIGURE_SIZES" title="Link to this definition"></a></dt>
<dd><p>dict() -&gt; new empty dictionary
dict(mapping) -&gt; new dictionary initialized from a mapping object’s</p>
<blockquote>
<div><p>(key, value) pairs</p>
</div></blockquote>
<dl>
<dt>dict(iterable) -&gt; new dictionary initialized as if via:</dt><dd><p>d = {}
for k, v in iterable:</p>
<blockquote>
<div><p>d[k] = v</p>
</div></blockquote>
</dd>
<dt>dict(<a href="#id1"><span class="problematic" id="id2">**</span></a>kwargs) -&gt; new dictionary initialized with the name=value pairs</dt><dd><p>in the keyword argument list.  For example:  dict(one=1, two=2)</p>
</dd>
</dl>
<p>Dictionary defining standard figure sizes for consistent plot generation:</p>
<ul class="simple">
<li><p>“small”: (6, 5) - For compact plots</p></li>
<li><p>“medium”: (8, 6) - Standard size plots</p></li>
<li><p>“large”: (10, 8) - Detailed analysis plots</p></li>
<li><p>“wide”: (12, 6) - Wide aspect ratio plots</p></li>
<li><p>“stars_grid”: (10, 8) - PSF star grid displays</p></li>
</ul>
</dd></dl>

</section>
<section id="photometric-bands-src-tools-py">
<h3>Photometric Bands (src/tools.py)<a class="headerlink" href="#photometric-bands-src-tools-py" title="Link to this heading"></a></h3>
<dl class="py data">
<dt class="sig sig-object py" id="src.tools.GAIA_BANDS">
<span class="sig-prename descclassname"><span class="pre">src.tools.</span></span><span class="sig-name descname"><span class="pre">GAIA_BANDS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">['phot_g_mean_mag',</span> <span class="pre">'phot_bp_mean_mag',</span> <span class="pre">'phot_rp_mean_mag',</span> <span class="pre">'u_jkc_mag',</span> <span class="pre">'v_jkc_mag',</span> <span class="pre">'b_jkc_mag',</span> <span class="pre">'r_jkc_mag',</span> <span class="pre">'i_jkc_mag',</span> <span class="pre">'u_sdss_mag',</span> <span class="pre">'g_sdss_mag',</span> <span class="pre">'r_sdss_mag',</span> <span class="pre">'i_sdss_mag',</span> <span class="pre">'z_sdss_mag']</span></em><a class="headerlink" href="#src.tools.GAIA_BANDS" title="Link to this definition"></a></dt>
<dd><p>Built-in mutable sequence.</p>
<p>If no argument is given, the constructor creates a new empty list.
The argument must be an iterable if specified.</p>
<p>List of supported GAIA and synthetic photometry bands:</p>
<ul class="simple">
<li><p>GAIA DR3: phot_g_mean_mag, phot_bp_mean_mag, phot_rp_mean_mag</p></li>
<li><p>Johnson-Cousins: u_jkc_mag, v_jkc_mag, b_jkc_mag, r_jkc_mag, i_jkc_mag</p></li>
<li><p>SDSS: u_sdss_mag, g_sdss_mag, r_sdss_mag, i_sdss_mag, z_sdss_mag</p></li>
</ul>
</dd></dl>

</section>
<section id="backend-api-backend-py">
<h3>Backend API (backend.py)<a class="headerlink" href="#backend-api-backend-py" title="Link to this heading"></a></h3>
<section id="user-management-endpoints">
<h4>User Management Endpoints<a class="headerlink" href="#user-management-endpoints" title="Link to this heading"></a></h4>
</section>
<section id="configuration-management">
<h4>Configuration Management<a class="headerlink" href="#configuration-management" title="Link to this heading"></a></h4>
</section>
<section id="error-handling">
<h4>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading"></a></h4>
</section>
</section>
</section>
<section id="usage-examples">
<h2>Usage Examples<a class="headerlink" href="#usage-examples" title="Link to this heading"></a></h2>
<section id="basic-pipeline-usage">
<h3>Basic Pipeline Usage<a class="headerlink" href="#basic-pipeline-usage" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">detection_and_photometry</span><span class="p">,</span> <span class="n">cross_match_with_gaia</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">safe_wcs_create</span><span class="p">,</span> <span class="n">extract_pixel_scale</span>

<span class="c1"># Load and process image</span>
<span class="n">wcs_obj</span><span class="p">,</span> <span class="n">wcs_error</span> <span class="o">=</span> <span class="n">safe_wcs_create</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
<span class="n">pixel_scale</span><span class="p">,</span> <span class="n">scale_source</span> <span class="o">=</span> <span class="n">extract_pixel_scale</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

<span class="c1"># Run photometry pipeline</span>
<span class="n">phot_table</span><span class="p">,</span> <span class="n">epsf_table</span><span class="p">,</span> <span class="n">daofind</span><span class="p">,</span> <span class="n">bkg</span><span class="p">,</span> <span class="n">refined_wcs</span> <span class="o">=</span> <span class="n">detection_and_photometry</span><span class="p">(</span>
    <span class="n">image_data</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">fwhm_pixels</span><span class="p">,</span> <span class="n">threshold_sigma</span><span class="p">,</span>
    <span class="n">border_mask</span><span class="p">,</span> <span class="n">filter_band</span>
<span class="p">)</span>

<span class="c1"># Cross-match with GAIA</span>
<span class="n">matched_table</span> <span class="o">=</span> <span class="n">cross_match_with_gaia</span><span class="p">(</span>
    <span class="n">phot_table</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">pixel_scale</span><span class="p">,</span> <span class="n">fwhm_pixels</span><span class="p">,</span>
    <span class="n">filter_band</span><span class="p">,</span> <span class="n">max_magnitude</span><span class="p">,</span> <span class="n">refined_wcs</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="custom-processing-workflow">
<h3>Custom Processing Workflow<a class="headerlink" href="#custom-processing-workflow" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">initialize_log</span><span class="p">,</span> <span class="n">write_to_log</span><span class="p">,</span> <span class="n">create_figure</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">estimate_background</span><span class="p">,</span> <span class="n">airmass</span>

<span class="c1"># Initialize logging</span>
<span class="n">log_buffer</span> <span class="o">=</span> <span class="n">initialize_log</span><span class="p">(</span><span class="s2">&quot;my_analysis&quot;</span><span class="p">)</span>
<span class="n">write_to_log</span><span class="p">(</span><span class="n">log_buffer</span><span class="p">,</span> <span class="s2">&quot;Starting custom analysis&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span>

<span class="c1"># Background estimation</span>
<span class="n">background</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">estimate_background</span><span class="p">(</span><span class="n">image_data</span><span class="p">)</span>
<span class="k">if</span> <span class="n">background</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">write_to_log</span><span class="p">(</span><span class="n">log_buffer</span><span class="p">,</span> <span class="s2">&quot;Background estimation successful&quot;</span><span class="p">)</span>

<span class="c1"># Calculate airmass</span>
<span class="n">air</span> <span class="o">=</span> <span class="n">airmass</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">observatory_data</span><span class="p">)</span>
<span class="n">write_to_log</span><span class="p">(</span><span class="n">log_buffer</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Airmass: </span><span class="si">{</span><span class="n">air</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Create standardized plots</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">create_figure</span><span class="p">(</span><span class="s2">&quot;large&quot;</span><span class="p">)</span>
<span class="c1"># ... plotting code ...</span>
</pre></div>
</div>
</section>
</section>
<section id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>All functions include comprehensive error handling and validation</p></li>
<li><p>Functions are designed to work together in the complete pipeline</p></li>
<li><p>Individual functions can be used for custom analysis workflows</p></li>
<li><p>Extensive logging and progress reporting throughout the pipeline</p></li>
<li><p>Streamlit integration for real-time user feedback and interaction</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="advanced_features.html" class="btn btn-neutral float-left" title="Advanced Features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024-2025, Pier-Francesco Rocci.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>